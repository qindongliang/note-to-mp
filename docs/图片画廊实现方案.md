# NoteToMP 图片画廊实现方案

## 当前状态
NoteToMP 插件目前不直接支持 `:::gallery` 语法，但可以通过以下方式实现图片画廊效果。

## 方案一：使用横向滚动容器（推荐）

### HTML 方式实现

```html
<div style="display: flex; overflow-x: auto; scroll-snap-type: x mandatory; gap: 10px; padding: 10px 0;">
  <img src="https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=600" style="min-width: 300px; height: 200px; object-fit: cover; border-radius: 8px;">
  <img src="https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=600" style="min-width: 300px; height: 200px; object-fit: cover; border-radius: 8px;">
  <img src="https://images.unsplash.com/photo-1477959858617-67f85cf4f1df?w=600" style="min-width: 300px; height: 200px; object-fit: cover; border-radius: 8px;">
</div>
```

### Markdown + HTML 混合

```markdown
<div style="display: flex; overflow-x: auto; scroll-snap-type: x mandatory; gap: 10px; padding: 10px 0;">
  <img src="https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=600" style="min-width: 300px; height: 200px; object-fit: cover; border-radius: 8px;">
  <img src="https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=600" style="min-width: 300px; height: 200px; object-fit: cover; border-radius: 8px;">
  <img src="https://images.unsplash.com/photo-1477959858617-67f85cf4f1df?w=600" style="min-width: 300px; height: 200px; object-fit: cover; border-radius: 8px;">
</div>
```

## 方案二：NoteToMP 主题中添加 Gallery 扩展

如果需要在 NoteToMP 中添加原生 gallery 支持，可以创建扩展：

### 1. 创建 Gallery 扩展文件

```typescript
// src/markdown/gallery.ts
import { Tokens, MarkedExtension } from "marked";
import { Extension } from "./extension";

export class GalleryRenderer extends Extension {
    markedExtension(): MarkedExtension {
        return {
            extensions: [{
                name: 'gallery',
                level: 'block',
                start(src: string) {
                    return src.indexOf(':::gallery');
                },
                tokenizer(src: string, tokens: any[]) {
                    const rule = /^:::\s*gallery\s*(?:\[([^\]]+)\])?\n([\s\S]*?)\n:::/;
                    const match = src.match(rule);
                    if (match) {
                        return {
                            type: 'gallery',
                            raw: match[0],
                            title: match[1] || '',
                            content: match[2]
                        };
                    }
                },
                renderer(token: Tokens.Generic) {
                    const title = token.title || '';
                    const images = token.content.trim().split('\n').filter(line => line.trim());
                    const imageHtml = images.map(img => {
                        const match = img.match(/!\[(.*?)\]\((.*?)\)/);
                        if (match) {
                            return `<img src="${match[2]}" alt="${match[1]}" style="min-width: 300px; height: 200px; object-fit: cover; border-radius: 8px;">`;
                        }
                        return '';
                    }).join('');

                    return `
                        <div style="margin: 1.5em 8px; padding: 16px; background: linear-gradient(135deg, rgba(200, 100, 66, 0.02), rgba(250, 249, 245, 0.95)); border: 1px solid rgba(200, 100, 66, 0.15); border-radius: 12px; box-shadow: 0 3px 12px rgba(200, 100, 66, 0.08); position: relative; overflow: hidden;">
                            <div style="display: flex; overflow-x: auto; scroll-snap-type: x mandatory; gap: 10px; padding: 10px 0;">
                                ${imageHtml}
                            </div>
                            ${title ? `<div style="text-align: center; font-size: 12px; color: rgba(200, 100, 66, 0.9); margin: 12px 0 0; padding: 10px 16px; background: linear-gradient(135deg, rgba(200, 100, 66, 0.06), rgba(200, 100, 66, 0.12)); border: 1px solid rgba(200, 100, 66, 0.25); border-radius: 12px;">${title}</div>` : ''}
                        </div>
                    `;
                }
            }]
        };
    }
}
```

### 2. 在 parser.ts 中注册

```typescript
// 在 parser.ts 的构造函数中添加
import { GalleryRenderer } from './gallery';

// 构造函数中
this.extensions.push(new GalleryRenderer(app, settings, assetsManager, callback));
```

### 3. 使用方式

```markdown
:::gallery[滑动浏览美景图片]
![山景图片](https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=600)
![海景图片](https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=600)
![城市图片](https://images.unsplash.com/photo-1477959858617-67f85cf4f1df?w=600)
:::
```

## 方案三：使用自定义 CSS

在 NoteToMP 自定义 CSS 笔记中添加：

```css
/* 图片画廊样式 */
.gallery-container {
    display: flex;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    gap: 10px;
    padding: 10px 0;
    margin: 1.5em 8px;
    background: linear-gradient(135deg, rgba(200, 100, 66, 0.02), rgba(250, 249, 245, 0.95));
    border: 1px solid rgba(200, 100, 66, 0.15);
    border-radius: 12px;
    box-shadow: 0 3px 12px rgba(200, 100, 66, 0.08);
}

.gallery-container img {
    min-width: 300px;
    height: 200px;
    object-fit: cover;
    border-radius: 8px;
}

.gallery-title {
    text-align: center;
    font-size: 12px;
    color: rgba(200, 100, 66, 0.9);
    margin: 12px 0 0;
    padding: 10px 16px;
    background: linear-gradient(135deg, rgba(200, 100, 66, 0.06), rgba(200, 100, 66, 0.12));
    border: 1px solid rgba(200, 100, 66, 0.25);
    border-radius: 12px;
}
```

然后在笔记中这样使用：

```markdown
<div class="gallery-container">
  <img src="image1.jpg">
  <img src="image2.jpg">
  <img src="image3.jpg">
</div>
<div class="gallery-title">滑动浏览美景图片</div>
```

## 推荐方案

**短期方案**：使用 **方案一（HTML 混合方式）**，简单直接，无需修改插件代码。

**长期方案**：如果需要，可以为 NoteToMP 添加原生 gallery 扩展支持。

## 注意事项

1. HTML 混合方式兼容性最好，在微信公众号中也能正常显示
2. 横向滚动需要足够的图片宽度才能看出效果
3. 建议为图片设置统一样式，保持一致性
